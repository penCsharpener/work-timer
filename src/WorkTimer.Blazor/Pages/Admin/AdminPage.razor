@page "/admin"
@using global::MediatR
@attribute [Authorize(Roles = "Admin")]
@inject IMediator Mediator

<h3>Administration</h3>

<EditForm Model="@RequestModel" OnValidSubmit="@HandleValidSubmitAsync">
    <DataAnnotationsValidator/>
    <ValidationSummary/>

    <ul class="d-flex flex-column justify-content-start align-items-start w-100">
        <li class="nav-item px-3">
            <MudCheckBox @bind-Checked="RequestModel.CalculateZeroHourWorkDays">Calculate Zero Hour Days</MudCheckBox>
        </li>
        <li class="nav-item px-3">
            <MudCheckBox @bind-Checked="RequestModel.RecalculateAllMyWorkDays">Recalculate all my work days</MudCheckBox>
        </li>
        <li class="nav-item px-3">
            <MudCheckBox @bind-Checked="RequestModel.RecalculateAllUsersHours">Recalculate all user's work days</MudCheckBox>
        </li>
        <li class="nav-item px-3">
            <MudCheckBox @bind-Checked="RequestModel.RecalculateAllWorkMonths">Recalculate all work months</MudCheckBox>
        </li>
    </ul>
    <div class="mt-4">
        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled">Run Batch Tasks</MudButton>
    </div>
</EditForm>


<div class="container">
    <p class="text-left @(ResponseModel.HasError ? "text-danger" : "text-info")">@ResponseModel.Message</p>
</div>

@code {

    public AdminRequest RequestModel { get; set; } = new AdminRequest();

    public AdminResponse ResponseModel { get; set; } = new AdminResponse();

    protected override async Task OnInitializedAsync() { }

    private async Task HandleValidSubmitAsync()
    {
        ResponseModel = await Mediator.Send(RequestModel);
    }

}
